<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è‹±æ–‡å–®å­—å­¸ç¿’ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#3B82F6", // è—è‰²ä¸»é¡Œï¼Œä»£è¡¨å­¸ç¿’å’Œå°ˆæ³¨
              secondary: "#10B981", // ç¶ è‰²ï¼Œä»£è¡¨æˆåŠŸå’Œé€²æ­¥
              accent: "#F59E0B", // æ©™è‰²ï¼Œç”¨æ–¼å¼·èª¿å’Œè­¦å‘Š
              dark: "#1F2937",
              "dark-light": "#374151",
              "light-gray": "#9CA3AF",
            },
            fontFamily: {
              sans: ["Inter", "sans-serif"],
            },
          },
        },
      };
    </script>
    <style>
      #words-container::-webkit-scrollbar {
        width: 10px;
        height: 1px;
      }
      #words-container::-webkit-scrollbar-thumb {
        border-radius: 10px;
        background-color: skyblue;
        background-image: -webkit-linear-gradient(
          45deg,
          rgba(255, 255, 255, 0.2) 25%,
          transparent 25%,
          transparent 50%,
          rgba(255, 255, 255, 0.2) 50%,
          rgba(255, 255, 255, 0.2) 75%,
          transparent 75%,
          transparent
        );
      }
      #words-container::-webkit-scrollbar-track {
        box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
        background: #ededed;
        border-radius: 10px;
      }
    </style>
    <style type="text/tailwindcss">
      @layer utilities {
        .content-auto {
          content-visibility: auto;
        }
        .card-hover {
          transition: all 0.3s ease;
        }
        .card-hover:hover {
          transform: translateY(-5px);
          box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1),
            0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .fade-in {
          animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
          from {
            opacity: 0;
          }
          to {
            opacity: 1;
          }
        }
        .flip-card {
          perspective: 1000px;
        }
        .flip-card-inner {
          transition: transform 0.6s;
          transform-style: preserve-3d;
        }
        .flip-card-front,
        .flip-card-back {
          backface-visibility: hidden;
        }
        .flip-card-back {
          transform: rotateY(180deg);
        }
        .flipped .flip-card-inner {
          transform: rotateY(180deg);
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-50 dark:bg-dark text-gray-800 dark:text-gray-200 min-h-screen flex flex-col"
  >
    <!-- å°èˆªæ¬„ -->
    <nav class="bg-white dark:bg-dark-light shadow-sm sticky top-0 z-50">
      <div
        class="container mx-auto px-4 py-3 flex justify-between items-center"
      >
        <div class="flex items-center space-x-2">
          <i class="fa-solid fa-book text-primary text-xl"></i>
          <h1 class="text-lg font-bold">è‹±æ–‡å–®å­—å­¸ç¿’</h1>
        </div>
        <div class="flex items-center space-x-4">
          <button
            id="theme-toggle"
            class="p-2 w-8 h-8 flex items-center rounded-full hover:bg-gray-100 dark:hover:bg-dark transition-colors"
          >
            <i class="fa-solid fa-moon text-gray-600 dark:text-gray-300"></i>
          </button>
          <button
            id="reset-data"
            class="hidden md:flex items-center space-x-1 text-sm text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors"
          >
            <i class="fa-solid fa-trash"></i>
            <span>é‡ç½®æ•¸æ“š</span>
          </button>
        </div>
      </div>
    </nav>

    <!-- ä¸»å…§å®¹ -->
    <main class="flex-1 container mx-auto px-4 py-8">
      <!-- æ­¡è¿å€åŸŸ -->
      <section class="text-center mb-10">
        <h2 class="text-2xl font-bold mb-2">æå‡ä½ çš„è‹±æ–‡èƒ½åŠ›</h2>
        <p class="text-light-gray">å»ºç«‹è‡ªå·±çš„å–®å­—åº«ï¼Œé€éæ¸¬é©—å¼·åŒ–è¨˜æ†¶</p>
      </section>

      <!-- çµ±è¨ˆè³‡è¨Š -->
      <section class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
        <div
          class="bg-white dark:bg-dark-light rounded-xl shadow p-6 card-hover border border-gray-100 dark:border-gray-700"
        >
          <div class="flex justify-between items-start mb-4">
            <h3 class="font-bold">ç¸½å–®å­—é‡</h3>
            <i class="fa-solid fa-book-open text-primary text-xl"></i>
          </div>
          <p class="text-3xl font-bold" id="total-words">0</p>
          <p class="text-light-gray text-sm">å€‹å–®å­—</p>
        </div>
        <div
          class="bg-white dark:bg-dark-light rounded-xl shadow p-6 card-hover border border-gray-100 dark:border-gray-700"
        >
          <div class="flex justify-between items-start mb-4">
            <h3 class="font-bold">å·²æŒæ¡</h3>
            <i class="fa-solid fa-check-circle text-secondary text-xl"></i>
          </div>
          <p class="text-3xl font-bold" id="mastered-words">0</p>
          <p class="text-light-gray text-sm">å€‹å–®å­—</p>
        </div>
        <div
          class="bg-white dark:bg-dark-light rounded-xl shadow p-6 card-hover border border-gray-100 dark:border-gray-700"
        >
          <div class="flex justify-between items-start mb-4">
            <h3 class="font-bold">å­¸ç¿’é€²åº¦</h3>
            <i class="fa-solid fa-chart-line text-accent text-xl"></i>
          </div>
          <p class="text-3xl font-bold" id="progress-percentage">0%</p>
          <div
            class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mt-2"
          >
            <div
              id="progress-bar"
              class="bg-accent h-2.5 rounded-full transition-all duration-500"
              style="width: 0%"
            ></div>
          </div>
        </div>
      </section>

      <!-- ä¸»è¦åŠŸèƒ½å€ -->
      <section class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- å–®å­—ç®¡ç† -->
        <div
          class="bg-white dark:bg-dark-light rounded-xl shadow p-6 border border-gray-100 dark:border-gray-700"
        >
          <div class="flex justify-between items-center mb-6">
            <h3 class="font-bold text-lg">æˆ‘çš„å–®å­—åº«</h3>
            <button
              id="add-word-btn"
              class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center"
            >
              <i class="fa-solid fa-plus mr-2"></i>
              æ·»åŠ å–®å­—
            </button>
          </div>

          <!-- æ·»åŠ å–®å­—è¡¨å–® -->
          <div id="add-word-form" class="hidden mb-6 fade-in">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label
                  for="word-input"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >è‹±æ–‡å–®å­—</label
                >
                <input
                  type="text"
                  id="word-input"
                  class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-dark focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-primary/70"
                  placeholder="è¼¸å…¥è‹±æ–‡å–®å­—"
                />
              </div>
              <div>
                <label
                  for="translation-input"
                  class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                  >ä¸­æ–‡ç¿»è­¯</label
                >
                <input
                  type="text"
                  id="translation-input"
                  class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-dark focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-primary/70"
                  placeholder="è¼¸å…¥ä¸­æ–‡ç¿»è­¯"
                />
              </div>
            </div>
            <div class="mt-4">
              <label
                for="example-input"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1"
                >ä¾‹å¥</label
              >
              <input
                type="text"
                id="example-input"
                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-dark focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-primary/70"
                placeholder="è¼¸å…¥ä¾‹å¥ (å¯é¸)"
              />
            </div>
            <div class="flex justify-end mt-4">
              <button
                id="cancel-add-word"
                class="mr-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              >
                å–æ¶ˆ
              </button>
              <button
                id="save-word"
                class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-colors"
              >
                ä¿å­˜
              </button>
            </div>
          </div>

          <!-- å–®å­—åˆ—è¡¨ -->
          <div id="words-container" class="max-h-40 overflow-y-auto">
            <div class="text-center py-8 text-light-gray">
              <i class="fa-solid fa-book-open text-4xl mb-4 opacity-30"></i>
              <p>å–®å­—åº«æ˜¯ç©ºçš„ï¼Œè«‹æ·»åŠ å–®å­—</p>
            </div>
          </div>
        </div>

        <!-- å–®å­—æ¸¬é©— -->
        <div
          class="bg-white dark:bg-dark-light rounded-xl shadow p-6 border border-gray-100 dark:border-gray-700"
        >
          <h3 class="font-bold text-lg mb-6">å–®å­—æ¸¬é©—</h3>

          <!-- æ¸¬é©—æ¨¡å¼é¸æ“‡ -->
          <div class="grid grid-cols-2 gap-4 mb-6">
            <button
              id="multiple-choice-mode"
              class="quiz-mode-btn bg-white dark:bg-dark-light border border-primary text-primary hover:bg-primary/5 py-4 rounded-lg transition-colors flex flex-col items-center"
            >
              <i class="fa-solid fa-list-ul text-2xl mb-2"></i>
              <span>å¤šé¸é¡Œ</span>
            </button>
            <button
              id="writing-mode"
              class="quiz-mode-btn bg-white dark:bg-dark-light border border-primary text-primary hover:bg-primary/5 py-4 rounded-lg transition-colors flex flex-col items-center"
            >
              <i class="fa-solid fa-pencil text-2xl mb-2"></i>
              <span>å¡«å¯«ç­”æ¡ˆ</span>
            </button>
          </div>

          <!-- å–®å­—å¡ç‰‡ -->
          <div id="quiz-card" class="hidden mb-6">
            <div class="flip-card h-64">
              <div class="flip-card-inner h-full relative">
                <div
                  class="flip-card-front h-full w-full absolute flex flex-col items-center justify-center p-6 border border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-dark-light"
                >
                  <h4
                    class="text-xl font-bold mb-4 text-primary"
                    id="quiz-word"
                  >
                    Word
                  </h4>
                  <p class="text-sm text-light-gray">è«‹é¸æ“‡æ­£ç¢ºçš„ä¸­æ–‡ç¿»è­¯</p>
                  <div class="mt-6 space-y-2 w-full" id="choices-container">
                    <!-- é¸é …å°‡ç”±JSå‹•æ…‹ç”Ÿæˆ -->
                  </div>
                </div>
                <div
                  class="flip-card-back h-full w-full absolute flex flex-col items-center justify-center p-6 border border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-dark-light"
                >
                  <h4
                    class="text-xl font-bold mb-2 text-primary"
                    id="answer-word"
                  >
                    Word
                  </h4>
                  <p class="text-lg mb-4" id="answer-translation">
                    Translation
                  </p>
                  <p class="text-sm text-light-gray italic" id="answer-example">
                    Example sentence
                  </p>
                  <div class="mt-6 flex space-x-4">
                    <button
                      id="know-btn"
                      class="bg-secondary hover:bg-secondary/90 text-white px-6 py-2 rounded-lg transition-colors"
                    >
                      <i class="fa-solid fa-check mr-2"></i>å·²æŒæ¡
                    </button>
                    <button
                      id="dont-know-btn"
                      class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg transition-colors"
                    >
                      <i class="fa-solid fa-times mr-2"></i>æœªæŒæ¡
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- å¡«å¯«ç­”æ¡ˆæ¨¡å¼ -->
          <div id="writing-quiz" class="hidden mb-6">
            <div
              class="h-64 flex flex-col items-center justify-center p-6 border border-gray-200 dark:border-gray-700 rounded-xl bg-white dark:bg-dark-light"
            >
              <h4 class="text-xl font-bold mb-4 text-primary" id="writing-word">
                Word
              </h4>
              <input
                type="text"
                id="writing-answer"
                class="w-full max-w-md px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-dark focus:outline-none focus:ring-2 focus:ring-primary dark:focus:ring-primary/70 text-center text-lg"
                placeholder="è«‹è¼¸å…¥ä¸­æ–‡ç¿»è­¯"
              />
              <button
                id="check-answer"
                class="mt-6 bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-lg transition-colors"
              >
                æª¢æŸ¥ç­”æ¡ˆ
              </button>
              <div id="writing-result" class="mt-4 hidden">
                <p class="text-lg font-bold" id="result-text"></p>
                <p class="text-sm text-light-gray" id="result-example"></p>
              </div>
            </div>
          </div>

          <!-- é–‹å§‹æ¸¬é©—æŒ‰éˆ• -->
          <button
            id="start-quiz"
            class="w-full py-3 bg-primary hover:bg-primary/90 text-white rounded-lg transition-colors"
          >
            é–‹å§‹æ¸¬é©—
          </button>

          <!-- çµæœçµ±è¨ˆ -->
          <div
            id="quiz-results"
            class="hidden mt-6 p-4 bg-gray-50 dark:bg-dark-light rounded-lg border border-gray-200 dark:border-gray-700"
          >
            <div class="flex justify-between text-sm mb-2">
              <span>æ­£ç¢º:</span>
              <span class="font-medium text-secondary" id="correct-count"
                >0</span
              >
            </div>
            <div class="flex justify-between text-sm">
              <span>éŒ¯èª¤:</span>
              <span class="font-medium text-red-500" id="incorrect-count"
                >0</span
              >
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- é è…³ -->
    <footer
      class="bg-white dark:bg-dark-light py-6 text-center text-light-gray text-sm border-t border-gray-100 dark:border-gray-700"
    >
      <p>Â© 2025 è‹±æ–‡å–®å­—å­¸ç¿’ç³»çµ± | æå‡ä½ çš„èªè¨€èƒ½åŠ›</p>
    </footer>

    <!-- ç¢ºèªå°è©±æ¡† -->
    <div
      id="confirm-dialog"
      class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden fade-in"
    >
      <div
        class="bg-white dark:bg-dark-light rounded-xl p-6 max-w-md w-full mx-4"
      >
        <h3 class="font-bold text-lg mb-4" id="dialog-title">ç¢ºèªæ“ä½œ</h3>
        <p class="text-gray-600 dark:text-gray-300 mb-6" id="dialog-message">
          ä½ ç¢ºå®šè¦åŸ·è¡Œæ­¤æ“ä½œå—ï¼Ÿ
        </p>
        <div class="flex justify-end space-x-4">
          <button
            id="dialog-cancel"
            class="px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
          >
            å–æ¶ˆ
          </button>
          <button
            id="dialog-confirm"
            class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors"
          >
            ç¢ºèª
          </button>
        </div>
      </div>
    </div>

    <script>
      // æ•¸æ“šæ¨¡å‹
      const STORAGE_KEY = "vocabulary_learner_data";
      let data = {
        words: [],
        quizResults: {
          correct: 0,
          incorrect: 0,
        },
        currentQuiz: {
          mode: null,
          words: [],
          currentIndex: 0,
          currentWord: null,
        },
      };

      // DOM å…ƒç´ 
      const addWordBtn = document.getElementById("add-word-btn");
      const addWordForm = document.getElementById("add-word-form");
      const cancelAddWord = document.getElementById("cancel-add-word");
      const saveWord = document.getElementById("save-word");
      const wordInput = document.getElementById("word-input");
      const translationInput = document.getElementById("translation-input");
      const exampleInput = document.getElementById("example-input");
      const wordsContainer = document.getElementById("words-container");
      const totalWordsEl = document.getElementById("total-words");
      const masteredWordsEl = document.getElementById("mastered-words");
      const progressPercentageEl = document.getElementById(
        "progress-percentage"
      );
      const progressBarEl = document.getElementById("progress-bar");
      const themeToggle = document.getElementById("theme-toggle");
      const resetDataBtn = document.getElementById("reset-data");
      const confirmDialog = document.getElementById("confirm-dialog");
      const dialogTitle = document.getElementById("dialog-title");
      const dialogMessage = document.getElementById("dialog-message");
      const dialogCancel = document.getElementById("dialog-cancel");
      const dialogConfirm = document.getElementById("dialog-confirm");
      const multipleChoiceModeBtn = document.getElementById(
        "multiple-choice-mode"
      );
      const writingModeBtn = document.getElementById("writing-mode");
      const startQuizBtn = document.getElementById("start-quiz");
      const quizCard = document.getElementById("quiz-card");
      const writingQuiz = document.getElementById("writing-quiz");
      const quizWord = document.getElementById("quiz-word");
      const choicesContainer = document.getElementById("choices-container");
      const answerWord = document.getElementById("answer-word");
      const answerTranslation = document.getElementById("answer-translation");
      const answerExample = document.getElementById("answer-example");
      const knowBtn = document.getElementById("know-btn");
      const dontKnowBtn = document.getElementById("dont-know-btn");
      const flipCard = document.querySelector(".flip-card");
      const writingWord = document.getElementById("writing-word");
      const writingAnswer = document.getElementById("writing-answer");
      const checkAnswerBtn = document.getElementById("check-answer");
      const writingResult = document.getElementById("writing-result");
      const resultText = document.getElementById("result-text");
      const resultExample = document.getElementById("result-example");
      const quizResults = document.getElementById("quiz-results");
      const correctCount = document.getElementById("correct-count");
      const incorrectCount = document.getElementById("incorrect-count");

      // åˆå§‹åŒ–
      function init() {
        // åŠ è¼‰æœ¬åœ°å­˜å„²æ•¸æ“š
        loadData();

        // æ›´æ–°å–®å­—åˆ—è¡¨
        updateWordsList();

        // æ›´æ–°çµ±è¨ˆä¿¡æ¯
        updateStats();

        // è¨»å†Šäº‹ä»¶ç›£è½å™¨
        registerEventListeners();

        // æª¢æŸ¥æ·±è‰²æ¨¡å¼
        checkDarkMode();
      }

      // å¾æœ¬åœ°å­˜å„²åŠ è¼‰æ•¸æ“š
      function loadData() {
        const savedData = localStorage.getItem(STORAGE_KEY);
        if (savedData) {
          data = JSON.parse(savedData);
        }
      }

      // ä¿å­˜æ•¸æ“šåˆ°æœ¬åœ°å­˜å„²
      function saveData() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
      }

      // è¨»å†Šäº‹ä»¶ç›£è½å™¨
      function registerEventListeners() {
        // æ·»åŠ å–®å­—æŒ‰éˆ•
        addWordBtn.addEventListener("click", () => {
          addWordForm.classList.remove("hidden");
          wordInput.focus();
        });

        // å–æ¶ˆæ·»åŠ å–®å­—
        cancelAddWord.addEventListener("click", () => {
          addWordForm.classList.add("hidden");
          clearAddWordForm();
        });

        // ä¿å­˜å–®å­—
        saveWord.addEventListener("click", () => {
          const word = wordInput.value.trim();
          const translation = translationInput.value.trim();
          const example = exampleInput.value.trim();

          if (!word || !translation) {
            alert("è«‹è¼¸å…¥å–®å­—å’Œç¿»è­¯");
            return;
          }

          addWord(word, translation, example);
          addWordForm.classList.add("hidden");
          clearAddWordForm();
        });

        // ä¸»é¡Œåˆ‡æ›
        themeToggle.addEventListener("click", toggleDarkMode);

        // é‡ç½®æ•¸æ“š
        resetDataBtn.addEventListener("click", () => {
          showConfirmDialog(
            "é‡ç½®æ‰€æœ‰æ•¸æ“š",
            "ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å–®å­—å’Œå­¸ç¿’è¨˜éŒ„å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¾©ã€‚",
            resetAllData
          );
        });

        // é¸æ“‡æ¸¬é©—æ¨¡å¼
        multipleChoiceModeBtn.addEventListener("click", () => {
          setQuizMode("multiple-choice");
        });

        writingModeBtn.addEventListener("click", () => {
          setQuizMode("writing");
        });

        // é–‹å§‹æ¸¬é©—
        startQuizBtn.addEventListener("click", startQuiz);

        // æª¢æŸ¥å¡«å¯«ç­”æ¡ˆ
        checkAnswerBtn.addEventListener("click", checkWritingAnswer);

        // å–®å­—å¡ç‰‡æŒ‰éˆ•
        knowBtn.addEventListener("click", () => {
          processAnswer(true);
        });

        dontKnowBtn.addEventListener("click", () => {
          processAnswer(false);
        });

        // å°è©±æ¡†æŒ‰éˆ•
        dialogCancel.addEventListener("click", () => {
          confirmDialog.classList.add("hidden");
        });

        dialogConfirm.addEventListener("click", () => {
          if (window.confirmAction) {
            window.confirmAction();
            confirmDialog.classList.add("hidden");
          }
        });
      }

      // æ·»åŠ æ–°å–®å­—
      function addWord(word, translation, example = "") {
        const newWord = {
          id: Date.now(),
          word,
          translation,
          example,
          mastered: false,
          learningCount: 0,
          lastReviewed: new Date().toISOString(),
        };

        data.words.push(newWord);
        saveData();
        updateWordsList();
        updateStats();
      }

      // æ›´æ–°å–®å­—åˆ—è¡¨
      function updateWordsList() {
        if (data.words.length === 0) {
          wordsContainer.innerHTML = `
                <div class="text-center py-8 text-light-gray">
                  <i class="fa-solid fa-book-open text-4xl mb-4 opacity-30"></i>
                  <p>å–®å­—åº«æ˜¯ç©ºçš„ï¼Œè«‹æ·»åŠ å–®å­—</p>
                </div>
                `;
          return;
        }

        wordsContainer.innerHTML = "";

        data.words.forEach((wordObj, index) => {
          const wordEl = document.createElement("div");
          wordEl.dataset.id = wordObj.id;
          wordEl.className =
            "flex items-center justify-between py-3 border-b border-gray-100 dark:border-gray-700 last:border-0 mx-4";
          wordEl.innerHTML = `
                  <div class="flex items-center">
                    <div class="mr-4 text-secondary">${index + 1}</div>
                    <div>
                      <h4 class="font-medium ${
                        wordObj.mastered ? "text-secondary line-through" : ""
                      }">${wordObj.word}</h4>
                      <p class="text-sm text-light-gray">${
                        wordObj.translation
                      }</p>
                      ${
                        wordObj.example
                          ? `<p class="text-xs text-light-gray italic mt-1">${wordObj.example}</p>`
                          : ""
                      }
                    </div>
                  </div>
                  <div class="flex items-center space-x-2">
                    <button class="edit-word text-light-gray hover:text-primary transition-colors">
                      <i class="fa-solid fa-pencil"></i>
                    </button>
                    <button class="delete-word text-light-gray hover:text-red-500 transition-colors">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                    ${
                      wordObj.mastered
                        ? `<button class="unmark-mastered text-light-gray hover:text-accent transition-colors">
                            <i class="fa-solid fa-undo"></i>
                        </button>`
                        : `<button class="mark-mastered text-light-gray hover:text-secondary transition-colors">
                            <i class="fa-solid fa-check"></i>
                        </button>`
                    }
                    <button class="play-word text-light-gray hover:text-primary transition-colors" ${
                      speechSynthesis ? "disable" : ""
                    }>
                      <i class="fa-solid fa-play"></i>
                    </button>
                  </div>
                `;

          wordsContainer.appendChild(wordEl);

          // æ·»åŠ äº‹ä»¶ç›£è½å™¨
          const editBtn = wordEl.querySelector(".edit-word");
          const deleteBtn = wordEl.querySelector(".delete-word");
          const playerBtn = wordEl.querySelector(".play-word");
          const markMasteredBtn = wordEl.querySelector(".mark-mastered");
          const unmarkMasteredBtn = wordEl.querySelector(".unmark-mastered");

          const wordId = wordObj.id;
          editBtn.addEventListener("click", () => {
            wordInput.value = wordObj.word;
            translationInput.value = wordObj.translation;
            exampleInput.value = wordObj.example;
            addWordForm.classList.remove("hidden");

            // ä¿®æ”¹ä¿å­˜æŒ‰éˆ•ç‚ºæ›´æ–°æŒ‰éˆ•
            saveWord.textContent = "æ›´æ–°";
            saveWord.removeEventListener("click", saveWordHandler);
            saveWord.addEventListener("click", () => {
              updateWord(wordId);
              addWordForm.classList.add("hidden");
              clearAddWordForm();
              saveWord.textContent = "ä¿å­˜";
              saveWord.removeEventListener("click", updateWordHandler);
              saveWord.addEventListener("click", saveWordHandler);
            });
          });

          deleteBtn.addEventListener("click", () => {
            showConfirmDialog(
              `åˆªé™¤å–®å­— "${wordObj.word}"`,
              "ç¢ºå®šè¦åˆªé™¤æ­¤å–®å­—å—ï¼Ÿ",
              () => deleteWord(wordId)
            );
          });

          playerBtn.addEventListener("click", () => {
            speechSynthesis.cancel();
            speechSynthesis.speak(new SpeechSynthesisUtterance(wordObj.word));
          });

          if (markMasteredBtn) {
            markMasteredBtn.addEventListener("click", () => {
              markWordAsMastered(wordId, true);
            });
          }

          if (unmarkMasteredBtn) {
            unmarkMasteredBtn.addEventListener("click", () => {
              markWordAsMastered(wordId, false);
            });
          }
        });
      }

      // æ›´æ–°å–®å­—
      function updateWord(wordId) {
        const wordIndex = data.words.findIndex((w) => w.id === wordId);
        if (wordIndex >= 0) {
          data.words[wordIndex].word = wordInput.value.trim();
          data.words[wordIndex].translation = translationInput.value.trim();
          data.words[wordIndex].example = exampleInput.value.trim();
          data.words[wordIndex].lastReviewed = new Date().toISOString();

          saveData();
          updateWordsList();
          updateStats();
        }
      }

      // åˆªé™¤å–®å­—
      function deleteWord(wordId) {
        data.words = data.words.filter((w) => w.id !== wordId);
        saveData();
        updateWordsList();
        updateStats();
      }

      // æ¨™è¨˜å–®å­—ç‚ºå·²æŒæ¡/æœªæŒæ¡
      function markWordAsMastered(wordId, mastered) {
        const word = data.words.find((w) => w.id === wordId);
        if (word) {
          word.mastered = mastered;
          word.lastReviewed = new Date().toISOString();

          if (mastered) {
            word.learningCount += 1;
          }

          saveData();
          updateWordsList();
          updateStats();
        }
      }

      // æ¸…é™¤æ·»åŠ å–®å­—è¡¨å–®
      function clearAddWordForm() {
        wordInput.value = "";
        translationInput.value = "";
        exampleInput.value = "";
        saveWord.textContent = "ä¿å­˜";
        saveWord.removeEventListener("click", updateWordHandler);
        saveWord.addEventListener("click", saveWordHandler);
      }

      // ä¿å­˜å–®å­—è™•ç†å™¨ï¼ˆç”¨æ–¼äº‹ä»¶å§”æ´¾ï¼‰
      function saveWordHandler() {
        const word = wordInput.value.trim();
        const translation = translationInput.value.trim();
        const example = exampleInput.value.trim();

        if (!word || !translation) {
          alert("è«‹è¼¸å…¥å–®å­—å’Œç¿»è­¯");
          return;
        }

        addWord(word, translation, example);
        addWordForm.classList.add("hidden");
        clearAddWordForm();
      }

      // æ›´æ–°å–®å­—è™•ç†å™¨ï¼ˆç”¨æ–¼äº‹ä»¶å§”æ´¾ï¼‰
      function updateWordHandler() {
        // é€™å€‹å‡½æ•¸åœ¨é‹è¡Œæ™‚è¨­ç½®
      }

      // æ›´æ–°çµ±è¨ˆä¿¡æ¯
      function updateStats() {
        const totalWords = data.words.length;
        const masteredWords = data.words.filter((w) => w.mastered).length;
        const progressPercentage =
          totalWords > 0 ? Math.round((masteredWords / totalWords) * 100) : 0;

        totalWordsEl.textContent = totalWords;
        masteredWordsEl.textContent = masteredWords;
        progressPercentageEl.textContent = `${progressPercentage}%`;
        progressBarEl.style.width = `${progressPercentage}%`;
      }

      // è¨­ç½®æ¸¬é©—æ¨¡å¼
      function setQuizMode(mode) {
        data.currentQuiz.mode = mode;

        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        multipleChoiceModeBtn.classList.toggle(
          "bg-primary/10",
          mode === "multiple-choice"
        );
        multipleChoiceModeBtn.classList.toggle(
          "text-primary",
          mode === "multiple-choice"
        );
        multipleChoiceModeBtn.classList.toggle(
          "border-primary",
          mode === "multiple-choice"
        );

        writingModeBtn.classList.toggle("bg-primary/10", mode === "writing");
        writingModeBtn.classList.toggle("text-primary", mode === "writing");
        writingModeBtn.classList.toggle("border-primary", mode === "writing");

        startQuizBtn.disabled = !mode;
      }

      // é–‹å§‹æ¸¬é©—
      function startQuiz() {
        if (!data.currentQuiz.mode || data.words.length === 0) {
          return;
        }

        // é‡ç½®æ¸¬é©—çµæœ
        data.quizResults = {
          correct: 0,
          incorrect: 0,
        };

        // æº–å‚™æ¸¬é©—å–®å­—ï¼ˆéš¨æ©Ÿé¸æ“‡ï¼‰
        const unmasteredWords = data.words.filter((w) => !w.mastered);
        if (unmasteredWords.length === 0) {
          alert("æ­å–œï¼ä½ å·²æŒæ¡æ‰€æœ‰å–®å­—ï¼");
          return;
        }

        // è‡³å°‘é¸æ“‡5å€‹å–®å­—ï¼Œæˆ–å…¨éƒ¨æœªæŒæ¡çš„å–®å­—
        const quizWordCount = Math.min(5, unmasteredWords.length);
        data.currentQuiz.words = [...unmasteredWords]
          .sort(() => 0.5 - Math.random())
          .slice(0, quizWordCount);
        data.currentQuiz.currentIndex = 0;

        // éš±è—ä¸»è¦å…§å®¹ï¼Œé¡¯ç¤ºæ¸¬é©—å¡ç‰‡
        wordsContainer.classList.add("hidden");
        addWordBtn.classList.add("hidden");
        quizCard.classList.add("hidden");
        writingQuiz.classList.add("hidden");
        quizResults.classList.remove("hidden");

        // é¡¯ç¤ºç¬¬ä¸€å€‹å–®å­—
        showNextWord();

        // æ›´æ–°çµæœé¡¯ç¤º
        updateQuizResults();
      }

      // é¡¯ç¤ºä¸‹ä¸€å€‹å–®å­—
      function showNextWord() {
        if (data.currentQuiz.currentIndex >= data.currentQuiz.words.length) {
          finishQuiz();
          return;
        }

        const currentWord =
          data.currentQuiz.words[data.currentQuiz.currentIndex];
        data.currentQuiz.currentWord = currentWord;

        // é‡ç½®å¡ç‰‡ç‹€æ…‹
        flipCard.classList.remove("flipped");

        if (data.currentQuiz.mode === "multiple-choice") {
          // é¡¯ç¤ºå¤šé¸é¡Œæ¨¡å¼
          quizCard.classList.remove("hidden");
          writingQuiz.classList.add("hidden");

          // è¨­ç½®å–®å­—
          quizWord.textContent = currentWord.word;
          answerWord.textContent = currentWord.word;
          answerTranslation.textContent = currentWord.translation;
          answerExample.textContent = currentWord.example || "æ²’æœ‰ä¾‹å¥";

          // ç”Ÿæˆé¸é …
          generateChoices(currentWord);
        } else if (data.currentQuiz.mode === "writing") {
          // é¡¯ç¤ºå¡«å¯«ç­”æ¡ˆæ¨¡å¼
          quizCard.classList.add("hidden");
          writingQuiz.classList.remove("hidden");

          // è¨­ç½®å–®å­—
          writingWord.textContent = currentWord.word;
          writingAnswer.value = "";
          writingResult.classList.add("hidden");

          // èšç„¦åˆ°è¼¸å…¥æ¡†
          writingAnswer.focus();
        }
      }

      // ç”Ÿæˆå¤šé¸é¡Œé¸é …
      function generateChoices(correctWord) {
        // ç²å–æ‰€æœ‰ç¿»è­¯
        const allTranslations = data.words.map((w) => w.translation);

        // æ’é™¤æ­£ç¢ºç­”æ¡ˆï¼Œéš¨æ©Ÿé¸æ“‡3å€‹éŒ¯èª¤ç­”æ¡ˆ
        const wrongTranslations = allTranslations
          .filter((t) => t !== correctWord.translation)
          .sort(() => 0.5 - Math.random())
          .slice(0, 3);

        // åˆä½µæ­£ç¢ºç­”æ¡ˆå’ŒéŒ¯èª¤ç­”æ¡ˆï¼Œä¸¦éš¨æ©Ÿæ’åº
        const choices = [correctWord.translation, ...wrongTranslations].sort(
          () => 0.5 - Math.random()
        );

        // æ¸…ç©ºé¸é …å®¹å™¨
        choicesContainer.innerHTML = "";

        // æ·»åŠ é¸é …æŒ‰éˆ•
        choices.forEach((choice) => {
          const button = document.createElement("button");
          button.className =
            "choice-btn w-full py-2 px-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-primary/5 text-left transition-colors";
          button.textContent = choice;

          button.addEventListener("click", () => {
            // æª¢æŸ¥ç­”æ¡ˆ
            if (choice === correctWord.translation) {
              data.quizResults.correct++;
              button.classList.add("bg-secondary/20", "border-secondary");
            } else {
              data.quizResults.incorrect++;
              button.classList.add("bg-red-500/20", "border-red-500");

              // æ‰¾å‡ºæ­£ç¢ºç­”æ¡ˆä¸¦é«˜äº®
              const correctButton = Array.from(
                choicesContainer.querySelectorAll(".choice-btn")
              ).find((btn) => btn.textContent === correctWord.translation);
              if (correctButton) {
                correctButton.classList.add(
                  "bg-secondary/20",
                  "border-secondary"
                );
              }
            }

            // æ›´æ–°çµæœ
            updateQuizResults();

            // ç¿»è½‰å¡ç‰‡é¡¯ç¤ºç­”æ¡ˆ
            setTimeout(() => {
              flipCard.classList.add("flipped");
            }, 1000);
          });

          choicesContainer.appendChild(button);
        });
      }

      // æª¢æŸ¥å¡«å¯«ç­”æ¡ˆ
      function checkWritingAnswer() {
        const userAnswer = writingAnswer.value.trim();
        const correctAnswer = data.currentQuiz.currentWord.translation;

        writingResult.classList.remove("hidden");

        if (userAnswer === correctAnswer) {
          data.quizResults.correct++;
          resultText.textContent = "æ­£ç¢ºï¼ğŸ‰";
          resultText.classList.add("text-secondary");
          resultText.classList.remove("text-red-500");
        } else {
          data.quizResults.incorrect++;
          resultText.textContent = `éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š${correctAnswer}`;
          resultText.classList.add("text-red-500");
          resultText.classList.remove("text-secondary");
        }

        resultExample.textContent =
          data.currentQuiz.currentWord.example || "æ²’æœ‰ä¾‹å¥";

        // æ›´æ–°çµæœ
        updateQuizResults();

        // ç¦ç”¨æŒ‰éˆ•
        checkAnswerBtn.disabled = true;

        // 3ç§’å¾Œé¡¯ç¤ºä¸‹ä¸€å€‹å–®å­—
        setTimeout(() => {
          data.currentQuiz.currentIndex++;
          showNextWord();
          checkAnswerBtn.disabled = false;
        }, 3000);
      }

      // è™•ç†ç­”æ¡ˆï¼ˆå¤šé¸é¡Œæ¨¡å¼ï¼‰
      function processAnswer(isKnown) {
        const currentWord = data.currentQuiz.currentWord;

        // å¦‚æœç”¨æˆ¶æ¨™è¨˜ç‚ºå·²æŒæ¡ï¼Œæ›´æ–°å–®å­—ç‹€æ…‹
        if (isKnown) {
          const wordIndex = data.words.findIndex(
            (w) => w.id === currentWord.id
          );
          if (wordIndex >= 0) {
            data.words[wordIndex].mastered = true;
            data.words[wordIndex].learningCount += 1;
            data.words[wordIndex].lastReviewed = new Date().toISOString();
            saveData();
            updateStats();
          }
        }

        // é¡¯ç¤ºä¸‹ä¸€å€‹å–®å­—
        data.currentQuiz.currentIndex++;
        showNextWord();
      }

      // æ›´æ–°æ¸¬é©—çµæœ
      function updateQuizResults() {
        correctCount.textContent = data.quizResults.correct;
        incorrectCount.textContent = data.quizResults.incorrect;
      }

      // å®Œæˆæ¸¬é©—
      function finishQuiz() {
        // è¨ˆç®—å¾—åˆ†
        const total = data.quizResults.correct + data.quizResults.incorrect;
        const score =
          total > 0 ? Math.round((data.quizResults.correct / total) * 100) : 0;

        // é¡¯ç¤ºçµæœ
        alert(
          `æ¸¬é©—å®Œæˆï¼ä½ çš„å¾—åˆ†æ˜¯ï¼š${score}åˆ† (${data.quizResults.correct}/${total})`
        );

        // é‡ç½®UI
        quizCard.classList.add("hidden");
        writingQuiz.classList.add("hidden");
        quizResults.classList.add("hidden");
        wordsContainer.classList.remove("hidden");
        addWordBtn.classList.remove("hidden");

        // æ›´æ–°å–®å­—åˆ—è¡¨
        updateWordsList();
      }

      // é¡¯ç¤ºç¢ºèªå°è©±æ¡†
      function showConfirmDialog(title, message, action) {
        dialogTitle.textContent = title;
        dialogMessage.textContent = message;
        window.confirmAction = action;
        confirmDialog.classList.remove("hidden");
      }

      // é‡ç½®æ‰€æœ‰æ•¸æ“š
      function resetAllData() {
        data = {
          words: [],
          quizResults: {
            correct: 0,
            incorrect: 0,
          },
          currentQuiz: {
            mode: null,
            words: [],
            currentIndex: 0,
            currentWord: null,
          },
        };

        saveData();
        updateWordsList();
        updateStats();
      }

      // æª¢æŸ¥æ·±è‰²æ¨¡å¼
      function checkDarkMode() {
        if (
          localStorage.getItem("darkMode") === "true" ||
          (localStorage.getItem("darkMode") !== "false" &&
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
          themeToggle.querySelector("i").classList.remove("fa-moon");
          themeToggle.querySelector("i").classList.add("fa-sun");
        }
      }

      // åˆ‡æ›æ·±è‰²æ¨¡å¼
      function toggleDarkMode() {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem("darkMode", isDark);

        const icon = themeToggle.querySelector("i");
        if (isDark) {
          icon.classList.remove("fa-moon");
          icon.classList.add("fa-sun");
        } else {
          icon.classList.remove("fa-sun");
          icon.classList.add("fa-moon");
        }
      }

      // åˆå§‹åŒ–æ‡‰ç”¨
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
